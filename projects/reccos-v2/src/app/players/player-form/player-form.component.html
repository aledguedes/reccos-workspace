<div class="mb-1">
  <h2 class="text-2xl md:text-3xl lg:text-4xl font-bold text-primary">
    {{ player ? 'Editar Jogador' : 'Novo Jogador' }}
  </h2>
  <p
    class="text-xs sm:text-sm md:text-base lg:text-lg text-muted-foreground mt-2 max-w-prose break-words whitespace-normal"
  >
    Preencha as informações do jogador para inscrição no torneio.
  </p>
</div>

<div
  class="bg-white rounded-xl p-4 md:p-8 border border-gray-200 shadow-lg space-y-6"
>
  <!-- Indicador de Progresso -->
  <div class="w-full mb-6">
    <div class="flex justify-between mb-2">
      <span class="text-sm font-medium"
        >Etapa {{ currentStep }} de {{ totalSteps }}</span
      >
      <span class="text-sm font-medium"
        >{{ (currentStep / totalSteps) * 100 }}%</span
      >
    </div>
    <div class="w-full bg-gray-200 rounded-full h-2.5">
      <div
        class="bg-primary h-2.5 rounded-full"
        [style.width.%]="(currentStep / totalSteps) * 100"
      ></div>
    </div>
  </div>

  <form
    [formGroup]="playerForm"
    (ngSubmit)="onSubmit()"
    class="space-y-4 md:space-y-6 p-0 md:p-6"
  >
    <!-- Etapa 1: Dados básicos de identificação -->
    <div
      *ngIf="currentStep === 1"
      formGroupName="personalInfo"
      class="space-y-4"
    >
      <h3 class="text-xl font-semibold text-primary mb-4">Dados Pessoais</h3>

      <!-- Nome completo -->
      <div class="form-control w-full mb-4">
        <label class="label">
          <span class="label-text">Nome Completo*</span>
        </label>
        <input
          type="text"
          placeholder="Digite o nome completo"
          class="input input-bordered w-full"
          [ngClass]="{
            'input-error':
              hasError('personalInfo', 'name', 'required') ||
              hasError('personalInfo', 'name', 'maxlength'),
          }"
          formControlName="name"
        />
        <label
          class="label"
          *ngIf="
            hasError('personalInfo', 'name', 'required') ||
            hasError('personalInfo', 'name', 'maxlength')
          "
        >
          <span class="label-text-alt text-error">{{
            getErrorMessage('personalInfo', 'name')
          }}</span>
        </label>
      </div>

      <!-- Data de nascimento e CPF na mesma linha -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div class="form-control w-full mb-4">
          <label class="label">
            <span class="label-text">Data de Nascimento*</span>
          </label>
          <input
            type="date"
            class="input input-bordered w-full"
            [ngClass]="{
              'input-error': hasError('personalInfo', 'birthDate', 'required'),
            }"
            formControlName="birthDate"
          />
          <label
            class="label"
            *ngIf="hasError('personalInfo', 'birthDate', 'required')"
          >
            <span class="label-text-alt text-error">
              {{ getErrorMessage('personalInfo', 'birthDate') }}
            </span>
          </label>
        </div>

        <div class="form-control w-full mb-4">
          <label class="label">
            <span class="label-text">CPF*</span>
          </label>
          <input
            type="text"
            placeholder="Digite o CPF"
            class="input input-bordered w-full"
            [ngClass]="{
              'input-error':
                hasError('personalInfo', 'document', 'required') ||
                hasError('personalInfo', 'document', 'maxlength'),
            }"
            formControlName="document"
          />
          <label
            class="label"
            *ngIf="
              hasError('personalInfo', 'document', 'required') ||
              hasError('personalInfo', 'document', 'maxlength')
            "
          >
            <span class="label-text-alt text-error">
              {{ getErrorMessage('personalInfo', 'document') }}
            </span>
          </label>
        </div>
      </div>

      <!-- Foto do jogador -->
      <div class="form-control w-full mb-4">
        <label class="label">
          <span class="label-text">Foto (opcional)</span>
        </label>
        <div class="flex items-center gap-4">
          <div
            class="w-24 h-24 bg-gray-100 rounded-md flex items-center justify-center overflow-hidden"
          >
            <img
              *ngIf="photoPreview"
              [src]="photoPreview"
              alt="Foto preview"
              class="w-full h-full object-cover"
            />
            <i
              *ngIf="!photoPreview"
              class="ri-user-line text-3xl text-gray-400"
            ></i>
          </div>
          <input
            type="file"
            class="file-input file-input-bordered w-full max-w-xs"
            accept="image/*"
            (change)="onPhotoChange($event)"
          />
        </div>
      </div>
    </div>

    <!-- Etapa 2: Dados de contato -->
    <div
      *ngIf="currentStep === 2"
      formGroupName="contactInfo"
      class="space-y-4"
    >
      <h3 class="text-xl font-semibold text-primary mb-4">
        Informações de Contato
      </h3>

      <!-- Telefone -->
      <div class="form-control w-full mb-4">
        <label class="label">
          <span class="label-text">Telefone*</span>
        </label>
        <input
          type="tel"
          placeholder="Digite o telefone (apenas números)"
          class="input input-bordered w-full"
          [ngClass]="{
            'input-error':
              hasError('contactInfo', 'phone', 'required') ||
              hasError('contactInfo', 'phone', 'pattern'),
          }"
          formControlName="phone"
        />
        <label
          class="label"
          *ngIf="
            hasError('contactInfo', 'phone', 'required') ||
            hasError('contactInfo', 'phone', 'pattern')
          "
        >
          <span class="label-text-alt text-error">{{
            getErrorMessage('contactInfo', 'phone')
          }}</span>
        </label>
      </div>

      <!-- E-mail -->
      <div class="form-control w-full mb-4">
        <label class="label">
          <span class="label-text">E-mail (opcional)</span>
        </label>
        <input
          type="email"
          placeholder="Digite o e-mail"
          class="input input-bordered w-full"
          [ngClass]="{
            'input-error':
              hasError('contactInfo', 'email', 'email') ||
              hasError('contactInfo', 'email', 'maxlength'),
          }"
          formControlName="email"
        />
        <label
          class="label"
          *ngIf="
            hasError('contactInfo', 'email', 'email') ||
            hasError('contactInfo', 'email', 'maxlength')
          "
        >
          <span class="label-text-alt text-error">{{
            getErrorMessage('contactInfo', 'email')
          }}</span>
        </label>
      </div>

      <!-- CEP -->
      <div class="form-control w-full mb-4">
        <label class="label">
          <span class="label-text">CEP*</span>
        </label>
        <div class="flex gap-2">
          <input
            type="text"
            placeholder="Digite o CEP"
            class="input input-bordered w-full"
            [ngClass]="{
              'input-error':
                hasError('contactInfo', 'cep', 'required') ||
                hasError('contactInfo', 'cep', 'pattern'),
            }"
            formControlName="cep"
            (blur)="buscarCEP()"
          />
        </div>
      </div>

      <!-- Endereço -->
      <div class="form-control w-full mb-4">
        <label class="label">
          <span class="label-text">Endereço (opcional)</span>
        </label>
        <input
          type="text"
          placeholder="Digite o endereço"
          class="input input-bordered w-full"
          [ngClass]="{
            'input-error': hasError('contactInfo', 'address', 'maxlength'),
          }"
          formControlName="address"
        />
      </div>

      <!-- Cidade e Estado na mesma linha -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div class="form-control w-full mb-4">
          <label class="label">
            <span class="label-text">Cidade (opcional)</span>
          </label>
          <input
            type="text"
            placeholder="Digite a cidade"
            class="input input-bordered w-full"
            [ngClass]="{
              'input-error': hasError('contactInfo', 'city', 'maxlength'),
            }"
            formControlName="city"
          />
          <label
            class="label"
            *ngIf="hasError('contactInfo', 'city', 'maxlength')"
          >
            <span class="label-text-alt text-error">{{
              getErrorMessage('contactInfo', 'city')
            }}</span>
          </label>
        </div>

        <div class="form-control w-full mb-4">
          <label class="label">
            <span class="label-text">Estado (opcional)</span>
          </label>
          <input
            type="text"
            placeholder="Digite o estado"
            class="input input-bordered w-full"
            [ngClass]="{
              'input-error': hasError('contactInfo', 'state', 'maxlength'),
            }"
            formControlName="state"
          />
          <label
            class="label"
            *ngIf="hasError('contactInfo', 'state', 'maxlength')"
          >
            <span class="label-text-alt text-error">{{
              getErrorMessage('contactInfo', 'state')
            }}</span>
          </label>
        </div>
      </div>
    </div>

    <!-- Etapa 3: Dados relacionados ao esporte -->
    <div *ngIf="currentStep === 3" formGroupName="sportInfo" class="space-y-4">
      <h3 class="text-xl font-semibold text-primary mb-4">
        Informações Esportivas
      </h3>

      <!-- Posição principal -->
      <div class="form-control w-full mb-4">
        <label class="label">
          <span class="label-text">Posição Principal*</span>
        </label>
        <select
          class="select select-bordered w-full"
          [ngClass]="{
            'select-error': hasError('sportInfo', 'position', 'required'),
          }"
          formControlName="position"
        >
          <option value="" disabled selected>Selecione a posição</option>
          <option *ngFor="let pos of positions" [value]="pos.value">
            {{ pos.label }}
          </option>
        </select>
        <label
          class="label"
          *ngIf="hasError('sportInfo', 'position', 'required')"
        >
          <span class="label-text-alt text-error">{{
            getErrorMessage('sportInfo', 'position')
          }}</span>
        </label>
      </div>

      <!-- Time atual -->
      <div class="form-control w-full mb-4">
        <label class="label">
          <span class="label-text">Time Atual (opcional)</span>
        </label>
        <select
          formControlName="teamId"
          class="select select-bordered w-full"
          [class.select-error]="hasError('sportInfo', 'teamId', 'required')"
        >
          <option value="">Selecione um time</option>
          @for (team of teams; track $index) {
            <option [value]="team.id">
              {{ team.name }}
            </option>
          }
        </select>
      </div>

      <!-- Número da camisa -->
      <div class="form-control w-full mb-4">
        <label class="label">
          <span class="label-text">Número da Camisa (opcional)</span>
        </label>
        <input
          type="number"
          placeholder="Digite o número da camisa"
          class="input input-bordered w-full"
          [ngClass]="{
            'input-error':
              hasError('sportInfo', 'jerseyNumber', 'min') ||
              hasError('sportInfo', 'jerseyNumber', 'max'),
          }"
          formControlName="jerseyNumber"
        />
        <label
          class="label"
          *ngIf="
            hasError('sportInfo', 'jerseyNumber', 'min') ||
            hasError('sportInfo', 'jerseyNumber', 'max')
          "
        >
          <span class="label-text-alt text-error">{{
            getErrorMessage('sportInfo', 'jerseyNumber')
          }}</span>
        </label>
      </div>
    </div>

    <!-- Etapa 4: Dados de saúde e emergência -->
    <div *ngIf="currentStep === 4" formGroupName="healthInfo" class="space-y-4">
      <h3 class="text-xl font-semibold text-primary mb-4">
        Informações de Saúde e Emergência
      </h3>

      <!-- Contato de emergência -->
      <div
        formGroupName="emergencyContact"
        class="space-y-4 p-4 bg-base-200 rounded-lg"
      >
        <h4 class="font-medium">Contato de Emergência</h4>

        <!-- Nome do contato de emergência -->
        <div class="form-control w-full mb-4">
          <label class="label">
            <span class="label-text">Nome do Contato*</span>
          </label>
          <input
            type="text"
            placeholder="Digite o nome do contato"
            class="input input-bordered w-full"
            [ngClass]="{
              'input-error':
                hasError('healthInfo', 'emergencyContact.name', 'required') ||
                hasError('healthInfo', 'emergencyContact.name', 'maxlength'),
            }"
            formControlName="name"
          />
          <label
            class="label"
            *ngIf="
              hasError('healthInfo', 'emergencyContact.name', 'required') ||
              hasError('healthInfo', 'emergencyContact.name', 'maxlength')
            "
          >
            <span class="label-text-alt text-error">{{
              getErrorMessage('healthInfo', 'emergencyContact.name')
            }}</span>
          </label>
        </div>

        <!-- Telefone do contato de emergência -->
        <div class="form-control w-full mb-4">
          <label class="label">
            <span class="label-text">Telefone do Contato*</span>
          </label>
          <input
            type="tel"
            placeholder="Digite o telefone (apenas números)"
            class="input input-bordered w-full"
            [ngClass]="{
              'input-error':
                hasError('healthInfo', 'emergencyContact.phone', 'required') ||
                hasError('healthInfo', 'emergencyContact.phone', 'pattern'),
            }"
            formControlName="phone"
          />
          <label
            class="label"
            *ngIf="
              hasError('healthInfo', 'emergencyContact.phone', 'required') ||
              hasError('healthInfo', 'emergencyContact.phone', 'pattern')
            "
          >
            <span class="label-text-alt text-error">{{
              getErrorMessage('healthInfo', 'emergencyContact.phone')
            }}</span>
          </label>
        </div>

        <!-- Relacionamento com o jogador -->
        <div class="form-control w-full mb-4">
          <label class="label">
            <span class="label-text">Relacionamento (opcional)</span>
          </label>
          <input
            type="text"
            placeholder="Ex: Pai, Mãe, Irmão"
            class="input input-bordered w-full"
            [ngClass]="{
              'input-error': hasError(
                'healthInfo',
                'emergencyContact.relationship',
                'maxlength'
              ),
            }"
            formControlName="relationship"
          />
          <label
            class="label"
            *ngIf="
              hasError(
                'healthInfo',
                'emergencyContact.relationship',
                'maxlength'
              )
            "
          >
            <span class="label-text-alt text-error">{{
              getErrorMessage('healthInfo', 'emergencyContact.relationship')
            }}</span>
          </label>
        </div>
      </div>

      <!-- Informações médicas adicionais -->
      <div class="space-y-4 p-4 mt-4">
        <!-- Tipo sanguíneo -->
        <div class="form-control w-full mb-4">
          <label class="label">
            <span class="label-text">Tipo Sanguíneo (opcional)</span>
          </label>
          <select
            class="select select-bordered w-full"
            formControlName="bloodType"
          >
            <option value="" disabled selected>
              Selecione o tipo sanguíneo
            </option>
            <option value="A+">A+</option>
            <option value="A-">A-</option>
            <option value="B+">B+</option>
            <option value="B-">B-</option>
            <option value="AB+">AB+</option>
            <option value="AB-">AB-</option>
            <option value="O+">O+</option>
            <option value="O-">O-</option>
          </select>
        </div>

        <!-- Alergias -->
        <div class="form-control w-full mb-4">
          <label class="label">
            <span class="label-text">Alergias (opcional)</span>
          </label>
          <textarea
            class="textarea textarea-bordered h-20"
            placeholder="Descreva alergias, se houver"
            [ngClass]="{
              'textarea-error': hasError(
                'healthInfo',
                'allergies',
                'maxlength'
              ),
            }"
            formControlName="allergies"
          ></textarea>
          <label
            class="label"
            *ngIf="hasError('healthInfo', 'allergies', 'maxlength')"
          >
            <span class="label-text-alt text-error">{{
              getErrorMessage('healthInfo', 'allergies')
            }}</span>
          </label>
        </div>

        <!-- Condições médicas -->
        <div class="form-control w-full mb-4">
          <label class="label">
            <span class="label-text">Condições Médicas (opcional)</span>
          </label>
          <textarea
            class="textarea textarea-bordered h-20"
            placeholder="Descreva condições médicas relevantes, se houver"
            [ngClass]="{
              'textarea-error': hasError(
                'healthInfo',
                'medicalConditions',
                'maxlength'
              ),
            }"
            formControlName="medicalConditions"
          ></textarea>
          <label
            class="label"
            *ngIf="hasError('healthInfo', 'medicalConditions', 'maxlength')"
          >
            <span class="label-text-alt text-error">{{
              getErrorMessage('healthInfo', 'medicalConditions')
            }}</span>
          </label>
        </div>
      </div>
    </div>

    <!-- Etapa 5: Confirmação dos dados -->
    <div *ngIf="currentStep === 5" class="space-y-6">
      <h3 class="text-2xl font-bold text-primary mb-6">
        Confirmação dos Dados
      </h3>

      <div class="bg-base-100 p-6">
        <h4
          class="text-lg font-semibold text-primary mb-4 pb-2 border-b border-gray-200"
        >
          Dados Pessoais
        </h4>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="space-y-1">
            <p class="font-medium text-sm text-gray-500">Nome Completo</p>
            <p class="text-base">{{ playerForm.value.personalInfo?.name }}</p>
          </div>
          <div class="space-y-1">
            <p class="font-medium text-sm text-gray-500">Data de Nascimento</p>
            <p class="text-base">
              {{
                playerForm.value.personalInfo?.birthDate | date: 'dd/MM/yyyy'
              }}
            </p>
          </div>
          <div class="space-y-1">
            <p class="font-medium text-sm text-gray-500">CPF</p>
            <p class="text-base">
              {{ playerForm.value.personalInfo?.document }}
            </p>
          </div>
          <div class="space-y-1">
            <p class="font-medium text-sm text-gray-500">Foto</p>
            <div class="w-16 h-16 rounded-full bg-gray-100 overflow-hidden">
              <img
                *ngIf="photoPreview"
                [src]="photoPreview"
                alt="Foto"
                class="w-full h-full object-cover"
              />
              <i
                *ngIf="!photoPreview"
                class="ri-user-line text-2xl text-gray-400 w-full h-full flex items-center justify-center"
              ></i>
            </div>
          </div>
        </div>
      </div>

      <div class="bg-base-100 p-6">
        <h4
          class="text-lg font-semibold text-primary mb-4 pb-2 border-b border-gray-200"
        >
          Contato
        </h4>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="space-y-1">
            <p class="font-medium text-sm text-gray-500">Telefone</p>
            <p class="text-base">{{ playerForm.value.contactInfo?.phone }}</p>
          </div>
          <div class="space-y-1">
            <p class="font-medium text-sm text-gray-500">E-mail</p>
            <p class="text-base">
              {{ playerForm.value.contactInfo?.email || 'Não informado' }}
            </p>
          </div>
          <div class="space-y-1">
            <p class="font-medium text-sm text-gray-500">Endereço</p>
            <p class="text-base">
              {{ playerForm.value.contactInfo?.address || 'Não informado' }}
            </p>
          </div>
          <div class="space-y-1">
            <p class="font-medium text-sm text-gray-500">CEP</p>
            <p class="text-base">
              {{ playerForm.value.contactInfo?.cep || 'Não informado' }}
            </p>
          </div>
        </div>
      </div>

      <div class="bg-base-100 p-6">
        <h4
          class="text-lg font-semibold text-primary mb-4 pb-2 border-b border-gray-200"
        >
          Informações Esportivas
        </h4>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="space-y-1">
            <p class="font-medium text-sm text-gray-500">Posição</p>
            <p class="text-base">{{ positionLabel }}</p>
          </div>
          <div>
            <p class="font-medium">Time:</p>
            <p>{{ teamName || 'Não informado' }}</p>
          </div>
          <div>
            <p class="font-medium">Número da Camisa:</p>
            <p>
              {{ playerForm.value.sportInfo?.jerseyNumber || 'Não informado' }}
            </p>
          </div>
        </div>
      </div>

      <div class="bg-base-100 p-6">
        <h4
          class="text-lg font-semibold text-primary mb-4 pb-2 border-b border-gray-200"
        >
          Informações de Saúde
        </h4>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="space-y-1">
            <p class="font-medium text-sm text-gray-500">Nome do Contato</p>
            <p class="text-base">
              {{ playerForm.value.healthInfo?.emergencyContact?.name }}
            </p>
          </div>
          <div class="space-y-1">
            <p class="font-medium text-sm text-gray-500">Telefone do Contato</p>
            <p class="text-base">
              {{ playerForm.value.healthInfo?.emergencyContact?.phone }}
            </p>
          </div>
          <div class="space-y-1">
            <p class="font-medium text-sm text-gray-500">Tipo Sanguíneo</p>
            <p class="text-base">
              {{ playerForm.value.healthInfo?.bloodType || 'Não informado' }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Botões de Navegação -->
    <div class="flex justify-between mt-6">
      <button
        *ngIf="currentStep > 1"
        type="button"
        class="btn btn-outline"
        (click)="previousStep()"
      >
        Voltar
      </button>
      <div class="flex-grow"></div>
      <div class="space-x-2">
        <button
          *ngIf="currentStep < totalSteps"
          type="button"
          class="btn btn-primary"
          (click)="nextStep()"
          [disabled]="!isCurrentStepValid()"
        >
          Próximo
        </button>
        <button
          *ngIf="currentStep === totalSteps"
          type="submit"
          class="btn btn-primary"
          [disabled]="playerForm.invalid || isSubmitting"
        >
          {{ isSubmitting ? 'Salvando...' : 'Salvar' }}
        </button>
        <button
          type="button"
          class="btn btn-ghost"
          (click)="onCancel()"
          [disabled]="isSubmitting"
        >
          Cancelar
        </button>
      </div>
    </div>
  </form>
</div>
